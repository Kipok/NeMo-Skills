processors_to_run: all

processors:
  - _target_: nemo_skills.finetuning.data_preparation_utils.preprocessing.ReadData
    preprocessed_dataset_files: open-math-instruct-1/train.jsonl open-math-instruct-1/validation.jsonl

  - _target_: nemo_skills.finetuning.data_preparation_utils.filters.DropMultiBoxed
    test_cases:
      - {input: {generation: "He had \\boxed{3} 4090s and \\boxed{2} 4080s"}, output: null}
      - {input: {generation: "She had \\boxed{6} 4090s"}, output: {generation: "She had \\boxed{6} 4090s"}}
      - {input: {generation: "boxed boxed 42"}, output: {generation: "boxed boxed 42"}}

  # - _target_: nemo_skills.finetuning.data_preparation_utils.filters.DropUselessCode

  - _target_: nemo_skills.finetuning.data_preparation_utils.filters.DropBrokenCode

  - _target_: nemo_skills.finetuning.data_preparation_utils.filters.TrimSolutions
    test_cases:
      - {input: {generation: "Solution ends at \\boxed{0}\nThis line is useless."}, output: {generation: "Solution ends at \\boxed{0}"}}
      - {input: {generation: "Solution continues \\boxed{7} after boxed"}, output: {generation: "Solution continues \\boxed{7} after boxed"}}

  - _target_: nemo_skills.finetuning.data_preparation_utils.preprocessing.GroupSamples

  - _target_: nemo_skills.finetuning.data_preparation_utils.filters.CodeTextFilter
    filter_type: any_code

  - _target_: nemo_skills.finetuning.data_preparation_utils.preprocessing.ShuffleAndDownsampleData
    num_samples: 1024000
    sampling_method: fair
    random_seed: 42
    do_shuffle: true

  - _target_: nemo_skills.finetuning.data_preparation_utils.preprocessing.WriteFinalSftManifest
    output_manifest_file: open-math-instruct-1/train_full_sft.jsonl
    prompt_type: openmathinstruct/sft
